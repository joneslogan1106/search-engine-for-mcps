
=== ./../mcps/agent/CONTRIBUTING.md ===
# Contributing to 1MCP

We love your input! We want to make contributing to 1MCP as easy and transparent as possible, whether it's:

- Reporting a bug
- Discussing the current state of the code
- Submitting a fix
- Proposing new features
- Becoming a maintainer

## Table of Contents

- [Development Process](#development-process)
- [Getting Started](#getting-started)
- [Pull Request Process](#pull-request-process)
- [Issue Guidelines](#issue-guidelines)
- [Coding Standards](#coding-standards)
- [Testing Guidelines](#testing-guidelines)
- [Documentation Guidelines](#documentation-guidelines)
- [Community Guidelines](#community-guidelines)

## Development Process

We use GitHub to host code, to track issues and feature requests, as well as accept pull requests.

1. Fork the repo and create your branch from `main`
2. If you've added code that should be tested, add tests
3. If you've changed APIs, update the documentation
4. Ensure the test suite passes
5. Make sure your code lints
6. Issue that pull request!

## Getting Started

### Prerequisites

- Node.js 18+ or 20+
- pnpm (recommended) or npm
- TypeScript 5.3+
- Git
- @modelcontextprotocol/sdk ^1.15.0 (automatically installed)

### Setting Up Your Development Environment

1. **Fork and Clone**

   ```bash
   # Fork the repository on GitHub, then clone your fork
   git clone https://github.com/1mcp-app/agent.git
   cd agent
   ```

2. **Install Dependencies**

   ```bash
   pnpm install
   ```

3. **Build the Project**

   ```bash
   pnpm build
   ```

4. **Run Tests**

   ```bash
   # Run unit tests
   pnpm test:unit

   # Run E2E tests
   pnpm test:e2e

   # Run all tests
   pnpm test:unit && pnpm test:e2e
   ```

5. **Start Development Server**
   ```bash
   pnpm dev
   ```

### Project Structure

Understanding the codebase structure will help you contribute effectively:

```
agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth/                  # Authentication & OAuth 2.1 system
â”‚   â”‚   â”œâ”€â”€ clientSessionManager.ts
â”‚   â”‚   â”œâ”€â”€ serverSessionManager.ts
â”‚   â”‚   â”œâ”€â”€ sdkOAuthClientProvider.ts
â”‚   â”‚   â”œâ”€â”€ sdkOAuthServerProvider.ts
â”‚   â”‚   â”œâ”€â”€ sessionTypes.ts
â”‚   â”‚   â””â”€â”€ authMiddleware.ts
â”‚   â”œâ”€â”€ capabilities/          # Server capability management
â”‚   â”œâ”€â”€ config/               # Configuration management (McpConfigManager)
â”‚   â”œâ”€â”€ core/                 # Core business logic & domain models
â”‚   â”‚   â”œâ”€â”€ server/           # Server management (ServerManager, AgentConfigManager)
â”‚   â”‚   â”œâ”€â”€ client/           # Client management (ClientManager, ClientFactory)
â”‚   â”‚   â””â”€â”€ types/            # Domain-specific type definitions
â”‚   â”œâ”€â”€ handlers/             # MCP request/notification handlers
â”‚   â”œâ”€â”€ logger/               # Structured logging system
â”‚   â”œâ”€â”€ services/             # Background services (config reload, etc.)
â”‚   â”œâ”€â”€ transport/            # Transport layer implementations
â”‚   â”‚   â”œâ”€â”€ http/             # HTTP/Express transport
â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts     # Express server implementation
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/       # HTTP endpoint handlers
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ oauthRoutes.ts      # OAuth endpoint handlers
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sseRoutes.ts        # Server-sent events routes
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ streamableHttpRoutes.ts # HTTP streaming routes
â”‚   â”‚   â”‚   â””â”€â”€ middlewares/  # HTTP middleware functions
â”‚   â”‚   â”‚       â”œâ”€â”€ errorHandler.ts     # Error handling middleware
â”‚   â”‚   â”‚       â”œâ”€â”€ scopeAuthMiddleware.ts # Scope-based authentication
â”‚   â”‚   â”‚       â”œâ”€â”€ securityMiddleware.ts # Security middleware
â”‚   â”‚   â”‚       â””â”€â”€ tagsExtractor.ts    # Tag extraction middleware
â”‚   â”‚   â””â”€â”€ transportFactory.ts # Transport factory pattern
â”‚   â”œâ”€â”€ utils/                # Shared utility functions
â”‚   â”‚   â”œâ”€â”€ clientFiltering.ts # Client filtering utilities
â”‚   â”‚   â”œâ”€â”€ errorHandling.ts   # Error handling utilities
â”‚   â”‚   â”œâ”€â”€ errorTypes.ts      # Error type definitions
â”‚   â”‚   â”œâ”€â”€ pagination.ts      # Result pagination utilities
â”‚   â”‚   â”œâ”€â”€ parsing.ts         # Input parsing utilities
â”‚   â”‚   â”œâ”€â”€ sanitization.ts    # Security input sanitization
â”‚   â””â”€â”€ e2e/                  # End-to-end tests
â”‚       â”œâ”€â”€ demo/             # Infrastructure demonstration tests
â”‚       â”œâ”€â”€ fixtures/         # Test server implementations
â”‚       â”œâ”€â”€ http/             # HTTP transport integration tests
â”‚       â”œâ”€â”€ integration/      # Multi-transport and performance tests
â”‚       â”œâ”€â”€ setup/            # Global test setup/teardown
â”‚       â”œâ”€â”€ stdio/            # STDIO transport tests
â”‚       â””â”€â”€ utils/            # Test utilities and helpers
â”œâ”€â”€ docs/                     # Documentation
â”‚   â”œâ”€â”€ ARCHITECTURE.md       # Technical architecture documentation
â”‚   â”œâ”€â”€ SECURITY.md          # Security guidelines and practices
â”‚   â”œâ”€â”€ asserts/             # Documentation assets
â”‚   â””â”€â”€ plans/               # Development planning documents
â”‚   â”‚   â””â”€â”€ scopeValidation.ts # OAuth scope validation
â”‚   â””â”€â”€ types.ts              # Global type definitions
â”œâ”€â”€ docs/                     # Documentation
â”œâ”€â”€ test/                     # Test files
â””â”€â”€ build/                    # Compiled output
```

## Pull Request Process

### Before You Submit

1. **Check for existing issues/PRs** - Search for existing issues or pull requests related to your change
2. **Create an issue first** - For significant changes, please create an issue to discuss the proposed changes
3. **Follow the coding standards** - Ensure your code follows the project's coding standards
4. **Write tests** - Add tests for any new functionality
5. **Update documentation** - Update relevant documentation for your changes

### Pull Request Guidelines

1. **Use a clear and descriptive title**

   ```
   Good: Add retry logic for MCP server connections
   Bad: Fix bug
   ```

2. **Provide a detailed description**
   - What changes were made and why
   - Link to related issues
   - Include screenshots for UI changes
   - List any breaking changes

3. **Follow the PR template**

   ```markdown
   ## Description

   Brief description of changes

   ## Type of Change

   - [ ] Bug fix (non-breaking change which fixes an issue)
   - [ ] New feature (non-breaking change which adds functionality)
   - [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)
   - [ ] Documentation update

   ## Testing

   - [ ] Tests pass locally
   - [ ] Added tests for new functionality
   - [ ] Manual testing completed

   ## Checklist

   - [ ] Code follows the style guidelines
   - [ ] Self-review completed
   - [ ] Documentation updated
   - [ ] No console.log statements left
   ```

4. **Keep PRs focused** - One feature/fix per PR when possible

5. **Ensure CI passes** - All automated checks must pass

### Review Process

1. **Automated Checks** - CI must pass (tests, linting, build)
2. **Code Review** - At least one maintainer must approve
3. **Testing** - Manual testing may be required for complex changes
4. **Documentation Review** - Documentation changes are reviewed for clarity and accuracy

## Issue Guidelines

### Reporting Bugs

Before creating a bug report, please check the existing issues to avoid duplicates.

**Use this template for bug reports:**

```markdown
## Bug Description

A clear and concise description of the bug.

## Steps to Reproduce

1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

## Expected Behavior

A clear description of what you expected to happen.

## Actual Behavior

A clear description of what actually happened.

## Environment

- OS: [e.g. macOS 14.0]
- Node.js version: [e.g. 20.10.0]
- 1MCP version: [e.g. 0.12.0]
- AI Client: [e.g. Claude Desktop, Cursor]

## Additional Context

Add any other context about the problem here.
```

### Feature Requests

**Use this template for feature requests:**

```markdown
## Feature Description

A clear and concise description of the feature you'd like to see.

## Problem Statement

What problem does this feature solve?

## Proposed Solution

Describe your proposed solution.

## Alternatives Considered

Describe any alternative solutions you've considered.

## Additional Context

Add any other context or screenshots about the feature request here.
```

## Coding Standards

### TypeScript Guidelines

1. **Use TypeScript strict mode** - All code must pass strict type checking
2. **Explicit types** - Use explicit types for function parameters and return values
3. **Interfaces over types** - Prefer interfaces for object types
4. **No `any` types** - Avoid using `any`; use proper typing

```typescript
// Good
interface ServerConfig {
  name: string;
  port: number;
  enabled: boolean;
}

function createServer(config: ServerConfig): Promise<Server> {
  // implementation
}

// Avoid
function createServer(config: any): any {
  // implementation
}
```

### Code Style

1. **ESLint configuration** - Follow the project's ESLint rules
2. **Prettier formatting** - Use Prettier for consistent formatting
3. **Naming conventions**:
   - `camelCase` for variables and functions
   - `PascalCase` for classes and interfaces
   - `UPPER_SNAKE_CASE` for constants

4. **File organization**:
   - One class/interface per file
   - Group related functionality
   - Clear import organization

### Error Handling

1. **Use specific error types** - Create custom error classes when appropriate
2. **Proper error propagation** - Don't swallow errors silently
3. **Logging** - Use the project's logging system

```typescript
// Good
import { MCPError, ErrorType } from './utils/errorTypes';

try {
  await connectToServer();
} catch (error) {
  logger.error('Failed to connect to server:', error);
  throw new MCPError(ErrorType.CONNECTION_ERROR, 'Server connection failed', error);
}

// Avoid
try {
  await connectToServer();
} catch (error) {
  // Silent failure
}
```

### Performance Considerations

1. **Async/await** - Use async/await over promises where possible
2. **Resource cleanup** - Properly clean up resources (connections, timers, etc.)
3. **Memory management** - Avoid memory leaks in long-running processes

## Testing Guidelines

### Test Structure

1. **Test files** - Place tests next to the code they test with `.test.ts` extension
2. **Test organization** - Group related tests using `describe` blocks
3. **Test naming** - Use descriptive test names

```typescript
describe('ServerManager', () => {
  describe('connectToServer', () => {
    it('should successfully connect to a valid MCP server', async () => {
      // Test implementation
    });

    it('should throw error when connection fails', async () => {
      // Test implementation
    });
  });
});
```

5. **Co-located unit tests** - Place unit tests next to source files with `.test.ts` extension
6. **E2E test fixtures** - Use dedicated test servers in `/test/e2e/fixtures/`

### Test Types

1. **Unit Tests** - Test individual functions/methods (co-located with source files)
2. **Integration Tests** - Test component interactions (included in E2E suite)
3. **End-to-End Tests** - Test complete workflows (separate test directory with fixtures)

### Test Framework

We use **Vitest** as our testing framework:

- **Unit Tests:** Fast, parallel execution with coverage
- **E2E Tests:** Sequential execution with longer timeouts
- **Coverage:** V8 provider with HTML/JSON/text reporting
- **Global Setup:** E2E tests have dedicated setup/teardown infrastructure

### Testing Best Practices

1. **Arrange, Act, Assert** - Structure tests clearly
2. **Mock external dependencies** - Use mocks for external services
3. **Test edge cases** - Include error conditions and boundary cases
4. **Cleanup** - Clean up resources after tests

### Running Tests

```bash
# Unit tests (fast, parallel)
pnpm test:unit
pnpm test:unit:watch
pnpm test:unit:coverage

# E2E tests (sequential, with fixtures)
pnpm test:e2e
pnpm test:e2e:watch
pnpm test:e2e:coverage

# Debug with MCP Inspector
pnpm inspector
```

```typescript
import { vi } from 'vitest';

describe('ClientManager', () => {
  afterEach(() => {
    vi.clearAllMocks();
  });

  it('should retry failed connections with exponential backoff', async () => {
    // Arrange
    const mockTransport = vi.fn().mockRejectedValueOnce(new Error('Connection failed'));

    // Act
    const result = await clientManager.connect(mockTransport);

    // Assert
    expect(mockTransport).toHaveBeenCalledTimes(3);
  });
});
```

## Documentation Guidelines

### Code Documentation

1. **JSDoc comments** - Document public APIs
2. **Inline comments** - Explain complex logic
3. **README updates** - Update README for user-facing changes

```typescript
/**
 * Connects to an MCP server with retry logic and exponential backoff.
 *
 * @param transport - The transport configuration for the server
 * @param options - Connection options including retry settings
 * @returns Promise that resolves to the connected server instance
 * @throws {MCPError} When connection fails after all retries
 */
async connectToServer(
  transport: Transport,
  options: ConnectionOptions = {}
): Promise<Server> {
  // Implementation
}
```

### Architecture Documentation

1. **Design decisions** - Document significant architectural choices
2. **Patterns used** - Explain design patterns and their benefits
3. **Data flow** - Document how data flows through the system

### User Documentation

1. **Clear examples** - Provide working code examples
2. **Step-by-step guides** - Break down complex procedures
3. **Troubleshooting** - Include common issues and solutions

## Community Guidelines

### Communication

1. **Be respectful** - Treat everyone with respect and kindness
2. **Be constructive** - Provide helpful feedback and suggestions
3. **Be patient** - Remember that maintainers are volunteers
4. **Ask questions** - Don't hesitate to ask for clarification

### Getting Help

1. **Check documentation** - Review existing docs first
2. **Search issues** - Look for existing discussions
3. **Create detailed issues** - Provide context and examples
4. **Join discussions** - Participate in community discussions

### Recognition

**Current Version:** 0.12.0

### Development Workflow

1. **Pre-commit hooks** - Husky ensures code quality before commits
2. **Lint-staged** - Only lint changed files for faster feedback
3. **Hot-reload** - Development server with automatic rebuild
4. **Configuration hot-reload** - MCP server configuration updates without restart

We value all contributions, including:

- Code contributions
- Documentation improvements
- Bug reports
- Feature suggestions
- Community support
- Testing and feedback

Contributors will be recognized in our release notes and contributor lists.

## Release Process

### Versioning

We follow [Semantic Versioning](https://semver.org/):

- **Major** (1.0.0) - Breaking changes
- **Minor** (0.1.0) - New features, backwards compatible
- **Patch** (0.0.1) - Bug fixes, backwards compatible

### Changelog

All notable changes are documented in [CHANGELOG.md](CHANGELOG.md) following [Keep a Changelog](https://keepachangelog.com/) format.

## License

By contributing, you agree that your contributions will be licensed under the same license as the project (Apache License 2.0).

## Questions?

If you have questions about contributing, please:

1. Check the existing documentation
2. Search through past issues
3. Create a new issue with the question label
4. Reach out to maintainers

Thank you for contributing to 1MCP! ğŸš€


=== ./../mcps/agent/CHANGELOG.md ===
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [0.13.1] - 2025-07-16

### ğŸš€ Features
- Introduce client session management repository and file storage service by @xizhibei
- Enhance OAuth session management and client data handling by @xizhibei

### ğŸ› Bug Fixes
- Remove FILE_PREFIX from AUTH_CONFIG session settings by @xizhibei
- Update tag filtering logic to match any tag and enhance test coverage by @xizhibei

### ğŸ’¼ Other
- Merge pull request #76 from 1mcp-app/fix/oauth by @xizhibei in [#76](https://github.com/1mcp-app/agent/pull/76)

### ğŸšœ Refactor
- Migrate to new repository architecture for OAuth storage by @xizhibei

### ğŸ§ª Testing
- Enhance ClientSessionRepository tests for FILE_PREFIX handling by @xizhibei


## [0.13.0] - 2025-07-15

### ğŸš€ Features
- Add debug logging for authorization and token management processes by @xizhibei
- Implement sanitizeHeaders utility for safe logging by @xizhibei
- Enhance E2E testing framework with new configurations and utilities by @xizhibei
- Implement grouped feature flags for auth and security features by @xizhibei
- Implement scope validation and user consent for OAuth authorization by @xizhibei
- Add dedicated parsing utilities with comprehensive tests by @xizhibei
- Enhance rate limiting configuration for OAuth endpoints by @xizhibei
- Introduce comprehensive sanitization utilities and refactor existing code by @xizhibei
- Implement rate limiting and HTML escaping in OAuth routes by @xizhibei
- Implement ClientSessionManager for file-based client session storage by @xizhibei
- Enhance transport and client management with OAuth support by @xizhibei
- Implement OAuth management routes and enhance client handling by @xizhibei
- Enhance OAuth client configuration and session management by @xizhibei
- Introduce SDKOAuthClientProvider and refactor authentication management by @xizhibei
- Implement MCPOAuthClientProvider for OAuth 2.1 authentication flow by @xizhibei
- Add Contributor Covenant Code of Conduct by @xizhibei

### ğŸ› Bug Fixes
- Improve XSS detection in input validation middleware by @xizhibei
- Limit input length in hashToUuid to prevent DoS attacks by @xizhibei
- Update dev script to enable authentication flag by @xizhibei
- Correct import paths and test mocks by @xizhibei
- Refine transport type inference based on URL suffix by @xizhibei

### ğŸ’¼ Other
- Merge pull request #71 from 1mcp-app/dependabot/npm_and_yarn/eslint/js-9.31.0 by @xizhibei in [#71](https://github.com/1mcp-app/agent/pull/71)
- Merge pull request #72 from 1mcp-app/dependabot/npm_and_yarn/tsc-watch-7.1.1 by @xizhibei in [#72](https://github.com/1mcp-app/agent/pull/72)
- Merge pull request #73 from 1mcp-app/dependabot/npm_and_yarn/globals-16.3.0 by @xizhibei in [#73](https://github.com/1mcp-app/agent/pull/73)
- Merge pull request #74 from 1mcp-app/dependabot/npm_and_yarn/prettier-3.6.2 by @xizhibei in [#74](https://github.com/1mcp-app/agent/pull/74)
- Merge pull request #75 from 1mcp-app/dependabot/npm_and_yarn/typescript-eslint/parser-8.37.0 by @xizhibei in [#75](https://github.com/1mcp-app/agent/pull/75)
- Merge pull request #70 from 1mcp-app/oauth by @xizhibei in [#70](https://github.com/1mcp-app/agent/pull/70)
- Merge branch 'main' into oauth by @xizhibei

### ğŸšœ Refactor
- Enhance input validation in hashToUuid method to prevent DoS attacks by @xizhibei
- Update mock from ConfigManager to McpConfigManager in SDKOAuthServerProvider tests by @xizhibei
- Replace ConfigManager with McpConfigManager and introduce AgentConfigManager by @xizhibei
- Rename and restructure client and server types for clarity and consistency by @xizhibei
- Transition Clients type from Record to Map for improved performance and functionality by @xizhibei
- Update rate limit configuration to use config manager by @xizhibei
- Create scope validation middleware using SDK's bearer auth by @xizhibei
- Reorganize middleware files to appropriate directories by @xizhibei
- Encapsulate client access with getClient method by @xizhibei
- Streamline route setup and remove redundant rate limiting by @xizhibei
- Migrate transport creation to transportFactory and remove deprecated config module by @xizhibei
- Update transport type in ClientInfo and enhance OAuth callback handling by @xizhibei
- Unify client session management in SDKOAuthClientProvider by @xizhibei
- Rename SessionManager to ServerSessionManager and introduce ClientSessionManager by @xizhibei
- Remove reconnectAfterOAuth function and streamline OAuth callback handling by @xizhibei
- Streamline OAuth client configuration and remove deprecated properties by @xizhibei
- Rename SDKOAuthProvider to SDKOAuthServerProvider by @xizhibei

### ğŸ“š Documentation
- Update CONTRIBUTING.md with enhanced testing guidelines and project structure by @xizhibei
- Add CONTRIBUTING.md to guide community contributions by @xizhibei
- Update README and CLI options for authentication and transport types by @xizhibei
- Update authentication and rate limiting features by @xizhibei

### ğŸ§ª Testing
- Mock ConfigManager in SDKOAuthServerProvider tests by @xizhibei
- Add unit tests for SDKOAuthClientProvider by @xizhibei

### âš™ï¸ Miscellaneous Tasks
- Update CHANGELOG.md for upcoming release by @xizhibei
- Update TypeScript configuration and improve path handling by @xizhibei
- Update package.json scripts and GitHub Actions workflow by @xizhibei


## [0.12.0] - 2025-07-08

### ğŸš€ Features
- Add error handling for missing streamable HTTP sessions by @xizhibei
- Implement ping handler for client health checks by @xizhibei
- Add Vitest support and type checking script by @xizhibei
- Refactor project structure and enhance authentication management by @xizhibei
- Add .cursorindexingignore and update .gitignore for improved file management by @xizhibei
- Update server info management and enhance initialization by @xizhibei
- Add unit tests for capability management and conflict resolution by @xizhibei
- Implement debounced configuration reload on file changes by @xizhibei
- Add comprehensive tests for cursor parsing and encoding utilities by @xizhibei
- Enhance connection handling and logging by @xizhibei
- Enhance URI parsing with robust validation and error handling by @xizhibei
- Enhance session and auth code validation with improved error handling by @xizhibei
- Add glama.json configuration file for maintainers by @xizhibei

### ğŸšœ Refactor
- Preserve original notification structure while modifying parameters by @xizhibei

### ğŸ§ª Testing
- Add vitest framework for client filtering tests by @xizhibei


## [0.11.0] - 2025-06-26

### ğŸš€ Features
- Add source-map-support for improved error stack traces by @xizhibei
- Add rate limiting for OAuth endpoints and update package dependencies by @xizhibei
- Enhance session management by adding path traversal validation for session IDs and auth codes by @xizhibei
- Add helper function to dynamically build OAuth issuer URL for improved environment support by @xizhibei
- Enhance OAuth 2.1 implementation with session ID prefixes, improved token validation, and comprehensive documentation by @xizhibei
- Implement OAuth 2.1 authentication with session management and middleware integration by @xizhibei
- Enhance error handling for notifications in client-server communication by @xizhibei
- Add CORS support and implement OAuth 2.1 endpoints for authorization and token management by @xizhibei
- Include outputSchema and annotations in tool registration for enhanced tool metadata by @xizhibei
- Implement completion request handlers and enhance capability checks in client operations by @xizhibei
- Add ElicitRequest and PingRequest handlers to improve client-server interaction by @xizhibei

### ğŸ› Bug Fixes
- For code scanning alert no. 4: Uncontrolled data used in path expression by @xizhibei in [#62](https://github.com/1mcp-app/agent/pull/62)

### ğŸšœ Refactor
- Update access token generation to use UUIDs and improve session management by @xizhibei

### ğŸ“š Documentation
- Update README to include new options for pagination, authentication, and session management by @xizhibei
- Add section on debugging and source maps to README by @xizhibei

### âš™ï¸ Miscellaneous Tasks
- Remove deprecated Docker build workflow and integrate into main workflow by @xizhibei


## [0.10.3] - 2025-06-11

### ğŸšœ Refactor
- Replace getInstance with getOrCreateInstance in tests for singleton behavior by @xizhibei


## [0.10.2] - 2025-06-11

### ğŸ› Bug Fixes
- Mcp client disconnect after reload by @xizhibei
- Restore status property in ClientInfo and update client disconnection handling by @xizhibei


## [0.10.1] - 2025-06-10

### ğŸ› Bug Fixes
- Infer transport type if missing and update validation logic by @xizhibei


## [0.10.0] - 2025-06-10

### ğŸš€ Features
- Add support for 'streamableHttp' transport type and refactor transport creation logic by @xizhibei
- Add pagination support to transport connection and related handlers by @xizhibei

### ğŸ› Bug Fixes
- Prevent duplicate listeners and increase max listeners for transport config changes by @xizhibei

### ğŸšœ Refactor
- Streamline resource and template listing with pagination support by @xizhibei
- Replace ERROR_CODES with ErrorCode in various files for improved error handling consistency by @xizhibei


## [0.9.0] - 2025-05-06

### ğŸ’¼ Other
- Streamable http transport by @xizhibei in [#34](https://github.com/1mcp-app/agent/pull/34)

### âš™ï¸ Miscellaneous Tasks
- Update Docker build workflow conditions to include branch checks by @xizhibei


## [0.8.2] - 2025-05-03

### ğŸ› Bug Fixes
- Update RequestHandlerExtra type to support generic parameters by @xizhibei


## [0.8.1] - 2025-05-03

### âš™ï¸ Miscellaneous Tasks
- Remove branch restriction from Docker build workflow for improved flexibility by @xizhibei


## [0.8.0] - 2025-04-14

### ğŸš€ Features
- Add Smithery.ai configuration file with command and schema definitions by @xizhibei
- Enable environment variable parsing with ONE_MCP prefix by @xizhibei
- Integrate client capabilities into createClient function and define server/client capabilities in constants by @xizhibei

### ğŸ› Bug Fixes
- Enhance logging capabilities with console transport and MCP transport integration by @xizhibei

### ğŸ’¼ Other
- Vitest by @xizhibei in [#19](https://github.com/1mcp-app/agent/pull/19)
- Merge pull request #14 from 1mcp-app/dependabot/npm_and_yarn/typescript-5.8.3 by @xizhibei in [#14](https://github.com/1mcp-app/agent/pull/14)
- Merge pull request #15 from 1mcp-app/dependabot/npm_and_yarn/express-5.1.0 by @xizhibei in [#15](https://github.com/1mcp-app/agent/pull/15)
- Merge pull request #16 from 1mcp-app/dependabot/npm_and_yarn/eslint-plugin-prettier-5.2.6 by @xizhibei in [#16](https://github.com/1mcp-app/agent/pull/16)
- Merge pull request #17 from 1mcp-app/dependabot/npm_and_yarn/modelcontextprotocol/sdk-1.9.0 by @xizhibei in [#17](https://github.com/1mcp-app/agent/pull/17)
- Merge pull request #18 from 1mcp-app/dependabot/npm_and_yarn/eslint/js-9.24.0 by @xizhibei in [#18](https://github.com/1mcp-app/agent/pull/18)
- Merge pull request #12 from 1mcp-app/dependabot/npm_and_yarn/types/node-22.13.14 by @xizhibei in [#12](https://github.com/1mcp-app/agent/pull/12)
- Merge pull request #13 from 1mcp-app/dependabot/npm_and_yarn/typescript-eslint/parser-8.29.0 by @xizhibei in [#13](https://github.com/1mcp-app/agent/pull/13)
- Merge pull request #11 from 1mcp-app/dependabot/npm_and_yarn/modelcontextprotocol/sdk-1.8.0 by @xizhibei in [#11](https://github.com/1mcp-app/agent/pull/11)
- Merge pull request #10 from 1mcp-app/dependabot/npm_and_yarn/ts-jest-29.3.1 by @xizhibei in [#10](https://github.com/1mcp-app/agent/pull/10)
- Merge pull request #9 from 1mcp-app/dependabot/npm_and_yarn/typescript-eslint/eslint-plugin-8.29.0 by @xizhibei in [#9](https://github.com/1mcp-app/agent/pull/9)

### ğŸšœ Refactor
- Enhance MCP transport integration and logging setup by @xizhibei

### ğŸ“š Documentation
- Add badges, Docker instructions, and environment variable configuration examples by @xizhibei

### âš™ï¸ Miscellaneous Tasks
- Update Docker build workflow to trigger on successful completion of the "Publish Package" workflow and enhance image metadata by @xizhibei
- Add GitHub Actions workflow for building and pushing Docker images by @xizhibei
- Add Dockerfile and .dockerignore for containerization by @xizhibei
- Consolidate release process by removing old release.yml and integrating steps into main.yml by @xizhibei

## New Contributors
* @github-actions[bot] made their first contribution

## [0.7.0] - 2025-03-27

### âš™ï¸ Miscellaneous Tasks
- Create temporary branch for changelog and version updates before pushing to main by @xizhibei


## [0.6.0] - 2025-03-26

### âš™ï¸ Miscellaneous Tasks
- Update release workflows to trigger on version tags and successful completion of publish job by @xizhibei


## [0.5.0] - 2025-03-26

### ğŸš€ Features
- Dynamically set MCP_SERVER_VERSION from package.json, improving version management and consistency by @xizhibei
- Enhance logging setup by adding SSEServerTransport support and configuring console transport for visibility, improving logging flexibility based on server type by @xizhibei
- Add comprehensive tests for clientManager and introduce utility functions for client filtering, enhancing test coverage and maintainability by @xizhibei
- Refactor operation execution with retry logic and introduce comprehensive tests for client operations, enhancing error handling and reliability by @xizhibei
- Enhance client capability management by adding filtering functions and updating request handlers to utilize capabilities, improving client interaction and resource management by @xizhibei

### ğŸ’¼ Other
- Merge pull request #3 from 1mcp-app/dependabot/npm_and_yarn/eslint/js-9.23.0 by @xizhibei in [#3](https://github.com/1mcp-app/agent/pull/3)
- Merge pull request #4 from 1mcp-app/dependabot/npm_and_yarn/ts-jest-29.3.0 by @xizhibei in [#4](https://github.com/1mcp-app/agent/pull/4)
- Merge pull request #5 from 1mcp-app/dependabot/npm_and_yarn/types/express-5.0.1 by @xizhibei in [#5](https://github.com/1mcp-app/agent/pull/5)
- Merge pull request #6 from 1mcp-app/dependabot/npm_and_yarn/eslint-9.23.0 by @xizhibei in [#6](https://github.com/1mcp-app/agent/pull/6)
- Merge pull request #7 from 1mcp-app/dependabot/npm_and_yarn/eslint-plugin-prettier-5.2.4 by @xizhibei in [#7](https://github.com/1mcp-app/agent/pull/7)

### ğŸšœ Refactor
- Remove log directory creation logic from logger setup, simplifying initialization process by @xizhibei

### âš™ï¸ Miscellaneous Tasks
- Automate version updates for MCP_SERVER_VERSION and package.json in changelog process by @xizhibei
- Add git-cliff configuration and automate changelog generation in workflows by @xizhibei
- Update inspector command in package.json for simplified usage and adjust README instructions accordingly by @xizhibei
- Automate version updates in package.json by @xizhibei
- Add author and bugs section to package.json for improved metadata and issue tracking by @xizhibei
- Add keywords for better discoverability and update homepage URL to GitHub repository by @xizhibei


## [0.4.0] - 2025-03-23

### âš™ï¸ Miscellaneous Tasks
- Update package and server version to 0.4.0 for consistency across project by @xizhibei


## [0.3.0] - 2025-03-23

### ğŸš€ Features
- Add HOST configuration for ExpressServer, allowing customizable host settings for SSE transport by @xizhibei
- Implement comprehensive Jest tests for ServerManager, covering transport connection, disconnection, and management methods to ensure robust functionality and error handling by @xizhibei
- Add Jest configuration and initial tests for ConfigManager, enhancing test coverage and ensuring proper functionality of configuration management by @xizhibei
- Add bug report issue template to streamline bug reporting process and improve user feedback collection by @xizhibei
- Add lint step by @xizhibei
- Add ESLint configuration and integrate TypeScript support, enhancing code quality and consistency across the project by @xizhibei
- Add support for client filtering by tags in transport connections, enhancing server-client interaction and flexibility by @xizhibei

### ğŸšœ Refactor
- Remove redundant file transport configurations from logger setup, simplifying logging structure and improving maintainability by @xizhibei
- Streamline transport handling in ServerManager and related components, enhancing type safety and maintainability by replacing ClientTransports with a more generic EnhancedTransport interface by @xizhibei
- Update configManager export and improve import structure in configReloadService for better clarity and maintainability by @xizhibei
- Consolidate transport-related types and schemas into a single file, improving organization and type safety across the application by @xizhibei
- Enhance client management with improved error handling and structured types, ensuring better resilience and maintainability in client operations by @xizhibei
- Update client management to use structured types for clients and transports, enhancing type safety and maintainability across the application by @xizhibei

### ğŸ“š Documentation
- Update transport options and add tags section for server filtering, enhancing configuration clarity and usage examples by @xizhibei


## [0.2.0] - 2025-03-19

### ğŸš€ Features
- Extend transport configuration to support 'http' type, enhancing transport options for improved flexibility by @xizhibei
- Implement global configuration management with dynamic path resolution and default config creation by @xizhibei
- Add Zod schema for transport configuration validation, improving error handling and flexibility in transport creation by @xizhibei
- Refactor client creation to utilize constants for server name and version, enhancing maintainability and consistency across the application by @xizhibei
- Refactor server initialization by introducing ExpressServer class for improved structure and maintainability by @xizhibei
- Enhance ConfigManager to accept custom config file path and update server setup to utilize it by @xizhibei
- Add MCP server capabilities constant and refactor server setup to utilize it by @xizhibei
- Add request/response logging middleware and enhance server with logging capabilities by @xizhibei
- Refactor server setup and introduce ServerManager for improved transport handling and logging by @xizhibei
- Enhance connection handling and logging in MCPTransport class by @xizhibei
- Enhance configuration reload logic with improved transport handling by @xizhibei

### ğŸšœ Refactor
- Enhance logging middleware with Zod schemas for request and notification validation, improving type safety and error handling by @xizhibei
- Update transport configuration types from MCPTransport to MCPServerParams, enhancing flexibility for transport creation and error handling by @xizhibei
- Restructure logger imports to use dedicated logger directory and enhance logging capabilities across the application by @xizhibei
- Remove defaultMeta from logger and update loggerName in MCP transport to '1mcp' by @xizhibei

### ğŸ“š Documentation
- Update quick start guide and configuration details, enhancing clarity on server setup and usage instructions by @xizhibei

### âš™ï¸ Miscellaneous Tasks
- Bump version to 0.2.0 and update README for enhanced transport options and configuration management by @xizhibei


## [0.1.0] - 2025-03-16

### ğŸš€ Features
- Create dependabot.yml by @xizhibei
- Integrate husky and lint-staged for improved pre-commit checks. by @xizhibei
- Add .node-version file and GitHub Actions workflow for package publishing. Introduced a version file for Node.js setup and created a CI workflow to automate package publishing to npm and GitHub Package Registry upon release events. Updated package.json to include repository information and publish configuration. by @xizhibei
- Add yargs and related types for command line argument parsing. Updated package.json and pnpm-lock.yaml to include yargs and its type definitions, enhancing the server's command line interface capabilities. Updated README with usage instructions for new transport options. by @xizhibei
- Rename project to 1MCP and update description for clarity. Changed package name and bin entry to reflect the new branding, and enhanced the project description to emphasize its unified MCP server capabilities. by @xizhibei
- Enhance logger configuration with custom formatting and improved file transport paths. Updated logger to use a custom format for console and file outputs, ensuring better log readability and structured output. Prevent logger from exiting on error to maintain stability. by @xizhibei
- Implement dynamic configuration reload service and configuration manager. Added graceful shutdown handling, integrated configuration watching, and improved transport management during configuration changes. by @xizhibei
- Introduce custom error types and centralized error handling utilities. Added new error codes to constants, implemented error handling in client operations and notification handlers, and enhanced request handlers with partial failure notifications. by @xizhibei
- Refactor server initialization and transport handling. Introduced modular client and transport management, added capability registration, and improved notification handling. Enhanced connection retry logic with configurable settings. by @xizhibei
- Integrate MCP transport for enhanced logging and connection status management. Added winston-transport dependency, updated logger to handle MCP connections, and implemented log level adjustments based on client connections. by @xizhibei
- Add application constants for server configuration and error handling by @xizhibei

### ğŸ› Bug Fixes
- Ensure callback is invoked when not connected to maintain log integrity. This change prevents potential log loss by calling the callback function when the transport is not connected. by @xizhibei

### ğŸ’¼ Other
- Merge pull request #1 from 1mcp-app/dependabot/npm_and_yarn/modelcontextprotocol/sdk-1.7.0 by @xizhibei in [#1](https://github.com/1mcp-app/agent/pull/1)
- Merge pull request #2 from 1mcp-app/dependabot/npm_and_yarn/types/node-22.13.10 by @xizhibei in [#2](https://github.com/1mcp-app/agent/pull/2)
- Enhance transport handling and connection logic. Introduced dynamic transport loading from mcp.json, improved retry logic with exponential backoff for client connections, and updated logging to include JSON stringification of notifications. by @xizhibei

### ğŸšœ Refactor
- Improve client connection logic with enhanced error handling and exponential backoff. Updated logging for connection attempts and added error handling for client creation failures. by @xizhibei

### ğŸ“š Documentation
- Update project overview and features, enhance server configuration details, and switch to pnpm for dependency management by @xizhibei

### ğŸ¨ Styling
- Update tab width from 4 to 2 spaces for consistency across the codebase. by @xizhibei

### âš™ï¸ Miscellaneous Tasks
- Add .editorconfig for consistent coding styles and update .gitignore to include additional files and directories by @xizhibei

## New Contributors
* @xizhibei made their first contribution in [#1](https://github.com/1mcp-app/agent/pull/1)
* @dependabot[bot] made their first contribution

[0.13.1]: https://github.com/1mcp-app/agent/compare/v0.13.0..v0.13.1
[0.13.0]: https://github.com/1mcp-app/agent/compare/v0.12.0..v0.13.0
[0.12.0]: https://github.com/1mcp-app/agent/compare/v0.11.0..v0.12.0
[0.11.0]: https://github.com/1mcp-app/agent/compare/v0.10.3..v0.11.0
[0.10.3]: https://github.com/1mcp-app/agent/compare/v0.10.2..v0.10.3
[0.10.2]: https://github.com/1mcp-app/agent/compare/v0.10.1..v0.10.2
[0.10.1]: https://github.com/1mcp-app/agent/compare/v0.10.0..v0.10.1
[0.10.0]: https://github.com/1mcp-app/agent/compare/v0.9.0..v0.10.0
[0.9.0]: https://github.com/1mcp-app/agent/compare/v0.8.2..v0.9.0
[0.8.2]: https://github.com/1mcp-app/agent/compare/v0.8.1..v0.8.2
[0.8.1]: https://github.com/1mcp-app/agent/compare/v0.8.0..v0.8.1
[0.8.0]: https://github.com/1mcp-app/agent/compare/v0.7.0..v0.8.0
[0.7.0]: https://github.com/1mcp-app/agent/compare/v0.6.0..v0.7.0
[0.6.0]: https://github.com/1mcp-app/agent/compare/v0.5.0..v0.6.0
[0.5.0]: https://github.com/1mcp-app/agent/compare/v0.4.0..v0.5.0
[0.4.0]: https://github.com/1mcp-app/agent/compare/v0.3.0..v0.4.0
[0.3.0]: https://github.com/1mcp-app/agent/compare/v0.2.0..v0.3.0
[0.2.0]: https://github.com/1mcp-app/agent/compare/v0.1.0..v0.2.0

<!-- generated by git-cliff -->


=== ./../mcps/agent/README.md ===
# 1MCP - One MCP Server for All

A unified Model Context Protocol server implementation that aggregates multiple MCP servers into one.

[![NPM Version](https://img.shields.io/npm/v/@1mcp/agent)](https://www.npmjs.com/package/@1mcp/agent)
[![NPM License](https://img.shields.io/npm/l/@1mcp/agent)](https://www.npmjs.com/package/@1mcp/agent)
[![smithery badge](https://smithery.ai/badge/@1mcp-app/agent)](https://smithery.ai/server/@1mcp-app/agent)

## Overview

1MCP (One MCP) is designed to simplify the way you work with AI assistants. Instead of configuring multiple MCP servers for different clients (Claude Desktop, Cherry Studio, Cursor, Roo Code, Claude, etc.), 1MCP provides a single, unified server that:

- Aggregates multiple MCP servers into one unified interface
- Reduces system resource usage by eliminating redundant server instances
- Simplifies configuration management across different AI assistants
- Provides a standardized way for AI models to interact with external tools and resources
- Supports dynamic configuration reloading without server restart
- Handles graceful shutdown and resource cleanup
- Includes comprehensive authentication and security features
- Supports advanced filtering, pagination, and request optimization

## Quick Start

To enable Cursor to use existing MCP servers already configured in Claude Desktop, follow these steps:

1. Run the 1MCP server with the Claude Desktop config file:

```bash
npx -y @1mcp/agent --config ~/Library/Application\ Support/Claude/claude_desktop_config.json
```

2. Add the 1MCP server to your Cursor config file (`~/.cursor/mcp.json`):

```json
{
  "mcpServers": {
    "1mcp": {
      "type": "http",
      "url": "http://localhost:3050/sse"
    }
  }
}
```

3. Enjoy it!

## Usage

You can run the server directly using `npx`:

```bash
# Basic usage (starts server with SSE transport)
npx -y @1mcp/agent

# Use existing Claude Desktop config
npx -y @1mcp/agent --config ~/Library/Application\ Support/Claude/claude_desktop_config.json

# Use stdio transport instead of SSE
npx -y @1mcp/agent --transport stdio

# Show all available options
npx -y @1mcp/agent --help
```

Available options:

| Option (CLI)                 | Environment Variable               | Description                                           |  Default  | Deprecated? |
| :--------------------------- | :--------------------------------- | :---------------------------------------------------- | :-------: | :---------: |
| `--transport`, `-t`          | `ONE_MCP_TRANSPORT`                | Choose transport type ("stdio", "http", or "sse")     |  "http"   |             |
| `--config`, `-c`             | `ONE_MCP_CONFIG`                   | Use a specific config file                            |           |             |
| `--port`, `-P`               | `ONE_MCP_PORT`                     | Change HTTP port                                      |   3050    |             |
| `--host`, `-H`               | `ONE_MCP_HOST`                     | Change HTTP host                                      | localhost |             |
| `--tags`, `-g`               | `ONE_MCP_TAGS`                     | Filter servers by tags                                |           |             |
| `--pagination`, `-p`         | `ONE_MCP_PAGINATION`               | Enable pagination for client/server lists (boolean)   |   false   |             |
| `--auth`                     | `ONE_MCP_AUTH`                     | Enable authentication (OAuth 2.1)                     |   false   |     Yes     |
| `--enable-auth`              | `ONE_MCP_ENABLE_AUTH`              | Enable authentication (OAuth 2.1)                     |   false   |             |
| `--enable-scope-validation`  | `ONE_MCP_ENABLE_SCOPE_VALIDATION`  | Enable tag-based scope validation (boolean)           |   true    |             |
| `--enable-enhanced-security` | `ONE_MCP_ENABLE_ENHANCED_SECURITY` | Enable enhanced security middleware (boolean)         |   false   |             |
| `--session-ttl`              | `ONE_MCP_SESSION_TTL`              | Session expiry time in minutes (number)               |   1440    |             |
| `--session-storage-path`     | `ONE_MCP_SESSION_STORAGE_PATH`     | Custom session storage directory path (string)        |           |             |
| `--rate-limit-window`        | `ONE_MCP_RATE_LIMIT_WINDOW`        | OAuth rate limit window in minutes (number)           |    15     |             |
| `--rate-limit-max`           | `ONE_MCP_RATE_LIMIT_MAX`           | Maximum requests per OAuth rate limit window (number) |    100    |             |
| `--help`, `-h`               |                                    | Show help                                             |           |             |

> ğŸ’¡ **Note:** Deprecated options are provided for backward compatibility. Prefer using the non-deprecated options for new configurations.

## Docker

You can also run 1MCP using Docker:

```bash
# Pull the latest image
docker pull ghcr.io/1mcp-app/agent:latest

# Run with HTTP transport (default)
docker run -p 3050:3050 ghcr.io/1mcp-app/agent

# Run with a custom config file
docker run -p 3050:3050 -v /path/to/config.json:/config.json ghcr.io/1mcp-app/agent --config /config.json

# Run with stdio transport
docker run -i ghcr.io/1mcp-app/agent --transport stdio
```

Available image tags:

- `latest`: Latest stable release
- `vX.Y.Z`: Specific version (e.g. `v1.0.0`)
- `sha-<commit>`: Specific commit

Example:

```bash
docker run -p 3051:3051 \
  -e ONE_MCP_PORT=3051 \
  -e ONE_MCP_TAGS=network,filesystem \
  ghcr.io/1mcp-app/agent
```

### Understanding Tags

Tags help you control which MCP servers are available to different clients. Think of tags as labels that describe what each server can do.

#### How to Use Tags

1. **In your server config**: Add tags to each server to describe its capabilities

```json
{
  "mcpServers": {
    "web-server": {
      "command": "uvx",
      "args": ["mcp-server-fetch"],
      "tags": ["network", "web"],
      "disabled": false
    },
    "file-server": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "~/Downloads"],
      "tags": ["filesystem"],
      "disabled": false
    }
  }
}
```

2. **When starting 1MCP in stdio mode**: You can filter servers by tags

```bash
# Only start servers with the "network" tag
npx -y @1mcp/agent --transport stdio --tags "network"

# Start servers with either "network" or "filesystem" tags
npx -y @1mcp/agent --transport stdio --tags "network,filesystem"
```

3. **When using SSE transport**: Clients can request servers with specific tags

```json
{
  "mcpServers": {
    "1mcp": {
      "type": "http",
      "url": "http://localhost:3050/sse?tags=network" // Only connect to network-capable servers
    }
  }
}
```

Example tags:

- `network`: For servers that make web requests
- `filesystem`: For servers that handle file operations
- `memory`: For servers that provide memory/storage
- `shell`: For servers that run shell commands
- `db`: For servers that handle database operations

## Configuration

### Global Configuration

The server automatically manages configuration in a global location:

- macOS/Linux: `~/.config/1mcp/mcp.json`
- Windows: `%APPDATA%/1mcp/mcp.json`

### Configuration File Format

```json
{
  "mcpServers": {
    "mcp-server-fetch": {
      "command": "uvx",
      "args": ["mcp-server-fetch"],
      "disabled": false
    },
    "server-memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"],
      "disabled": false
    }
  }
}
```

## How It Works

### System Architecture

```mermaid
graph TB
    subgraph "AI Assistants"
        A1[Claude Desktop]
        A2[Cursor]
        A3[Cherry Studio]
        A4[Roo Code]
    end

    subgraph "1MCP Server"
        MCP[1MCP Agent]
    end

    subgraph "MCP Servers"
        S1[Server 1]
        S2[Server 2]
        S3[Server 3]
    end

    A1 -->|http| MCP
    A2 -->|http| MCP
    A3 -->|http| MCP
    A4 -->|http| MCP

    MCP --> |http| S1
    MCP --> |stdio| S2
    MCP --> |stdio| S3
```

### Request Flow

```mermaid
sequenceDiagram
    participant Client as AI Assistant
    participant 1MCP as 1MCP Server
    participant MCP as MCP Servers

    Client->>1MCP: Send MCP Request
    activate 1MCP

    1MCP->>1MCP: Validate Request
    1MCP->>1MCP: Load Config
    1MCP->>MCP: Forward Request
    activate MCP

    MCP-->>1MCP: Response
    deactivate MCP

    1MCP-->>Client: Forward Response
    deactivate 1MCP
```

## Development

Install dependencies:

```bash
pnpm install
```

Build the server:

```bash
pnpm build
```

For development with auto-rebuild:

```bash
pnpm watch
```

Run the server:

```bash
pnpm dev
```

### Debugging

Using the [MCP Inspector](https://github.com/modelcontextprotocol/inspector), which is available as a package script:

```bash
pnpm inspector
```

The Inspector will provide a URL to access debugging tools in your browser.

## Debugging & Source Maps

This project uses [source-map-support](https://www.npmjs.com/package/source-map-support) to enhance stack traces. When you run the server, stack traces will reference the original TypeScript source files instead of the compiled JavaScript. This makes debugging much easier, as error locations and line numbers will match your source code.

No extra setup is requiredâ€”this is enabled by default. If you see a stack trace, it will point to `.ts` files and the correct line numbers. ğŸ—ºï¸


=== ./../mcps/agent/CODE_OF_CONDUCT.md ===
# Contributor Covenant Code of Conduct

## Our Pledge

We as members, contributors, and leaders pledge to make participation in our
community a harassment-free experience for everyone, regardless of age, body
size, visible or invisible disability, ethnicity, sex characteristics, gender
identity and expression, level of experience, education, socio-economic status,
nationality, personal appearance, race, religion, or sexual identity
and orientation.

We pledge to act and interact in ways that contribute to an open, welcoming,
diverse, inclusive, and healthy community.

## Our Standards

Examples of behavior that contributes to a positive environment for our
community include:

* Demonstrating empathy and kindness toward other people
* Being respectful of differing opinions, viewpoints, and experiences
* Giving and gracefully accepting constructive feedback
* Accepting responsibility and apologizing to those affected by our mistakes,
  and learning from the experience
* Focusing on what is best not just for us as individuals, but for the
  overall community

Examples of unacceptable behavior include:

* The use of sexualized language or imagery, and sexual attention or
  advances of any kind
* Trolling, insulting or derogatory comments, and personal or political attacks
* Public or private harassment
* Publishing others' private information, such as a physical or email
  address, without their explicit permission
* Other conduct which could reasonably be considered inappropriate in a
  professional setting

## Enforcement Responsibilities

Community leaders are responsible for clarifying and enforcing our standards of
acceptable behavior and will take appropriate and fair corrective action in
response to any behavior that they deem inappropriate, threatening, offensive,
or harmful.

Community leaders have the right and responsibility to remove, edit, or reject
comments, commits, code, wiki edits, issues, and other contributions that are
not aligned to this Code of Conduct, and will communicate reasons for moderation
decisions when appropriate.

## Scope

This Code of Conduct applies within all community spaces, and also applies when
an individual is officially representing the community in public spaces.
Examples of representing our community include using an official e-mail address,
posting via an official social media account, or acting as an appointed
representative at an online or offline event.

## Enforcement

Instances of abusive, harassing, or otherwise unacceptable behavior may be
reported to the community leaders responsible for enforcement at
xuzp@1mcp.app.
All complaints will be reviewed and investigated promptly and fairly.

All community leaders are obligated to respect the privacy and security of the
reporter of any incident.

## Enforcement Guidelines

Community leaders will follow these Community Impact Guidelines in determining
the consequences for any action they deem in violation of this Code of Conduct:

### 1. Correction

**Community Impact**: Use of inappropriate language or other behavior deemed
unprofessional or unwelcome in the community.

**Consequence**: A private, written warning from community leaders, providing
clarity around the nature of the violation and an explanation of why the
behavior was inappropriate. A public apology may be requested.

### 2. Warning

**Community Impact**: A violation through a single incident or series
of actions.

**Consequence**: A warning with consequences for continued behavior. No
interaction with the people involved, including unsolicited interaction with
those enforcing the Code of Conduct, for a specified period of time. This
includes avoiding interactions in community spaces as well as external channels
like social media. Violating these terms may lead to a temporary or
permanent ban.

### 3. Temporary Ban

**Community Impact**: A serious violation of community standards, including
sustained inappropriate behavior.

**Consequence**: A temporary ban from any sort of interaction or public
communication with the community for a specified period of time. No public or
private interaction with the people involved, including unsolicited interaction
with those enforcing the Code of Conduct, is allowed during this period.
Violating these terms may lead to a permanent ban.

### 4. Permanent Ban

**Community Impact**: Demonstrating a pattern of violation of community
standards, including sustained inappropriate behavior,  harassment of an
individual, or aggression toward or disparagement of classes of individuals.

**Consequence**: A permanent ban from any sort of public interaction within
the community.

## Attribution

This Code of Conduct is adapted from the [Contributor Covenant][homepage],
version 2.0, available at
https://www.contributor-covenant.org/version/2/0/code_of_conduct.html.

Community Impact Guidelines were inspired by [Mozilla's code of conduct
enforcement ladder](https://github.com/mozilla/diversity).

[homepage]: https://www.contributor-covenant.org

For answers to common questions about this code of conduct, see the FAQ at
https://www.contributor-covenant.org/faq. Translations are available at
https://www.contributor-covenant.org/translations.


=== ./../mcps/agent/test/e2e/README.md ===
# E2E Testing for 1MCP Agent

This directory contains comprehensive end-to-end tests for the 1MCP agent, covering both stdio and HTTP transports with real MCP protocol communication.

## Test Structure

```
src/test/e2e/
â”œâ”€â”€ fixtures/           # Test MCP servers
â”œâ”€â”€ utils/             # Test utilities and helpers
â”œâ”€â”€ stdio/             # Stdio transport E2E tests
â”œâ”€â”€ http/              # HTTP transport E2E tests
â”œâ”€â”€ integration/       # Multi-transport integration tests
â””â”€â”€ setup/             # Global test setup/teardown
```

## Test Fixtures

The test fixtures include simple MCP servers for various testing scenarios:

- **echo-server.js** - Reflects all requests for basic communication testing
- **error-server.js** - Returns various error conditions for error handling tests
- **capability-server.js** - Tests resource/tool/prompt capabilities
- **slow-server.js** - Introduces delays for timeout testing
- **crash-server.js** - Intentionally crashes for error scenario testing

## Running E2E Tests

### Working Demo Tests (Recommended)

```bash
# Run the working infrastructure demo
pnpm test:e2e:demo

# Or run all E2E tests (currently only demo tests)
pnpm test:e2e
```

### Watch Mode

```bash
pnpm test:e2e:watch
```

### Full Test Suite (Future)

```bash
# Stdio transport tests (requires MCP SDK fixes)
pnpm test:e2e:stdio

# HTTP transport tests (requires full implementation)
pnpm test:e2e:http

# Integration tests (requires working servers)
pnpm test:e2e:integration
```

### Combined Unit + E2E Tests

```bash
pnpm test:all
```

## Current Status

âœ… **Working Components:**

- E2E test directory structure and organization
- Test utilities (ConfigBuilder, ProtocolValidator, TestProcessManager)
- Test configuration generation and management
- Protocol validation for JSON-RPC and MCP messages
- Basic process management for test scenarios

âš ï¸ **Pending Components:**

- MCP test servers (require SDK compatibility fixes)
- Full stdio transport E2E tests (require working test servers)
- HTTP transport E2E tests (require full HTTP implementation)
- Integration tests (require working MCP protocol communication)

The E2E test infrastructure is complete and demonstrated with working tests. The comprehensive test suites await resolution of MCP SDK compatibility issues and full server implementation.

## Test Categories

### Stdio Transport Tests

- **stdio-lifecycle.test.ts** - Process management and server lifecycle
- **stdio-protocol.test.ts** - MCP protocol communication over stdio
- **stdio-errors.test.ts** - Error handling and edge cases
- **stdio-integration.test.ts** - Full client workflow scenarios

### HTTP Transport Tests

- **http-auth.test.ts** - OAuth 2.1 authentication flows
- **http-mcp.test.ts** - MCP protocol over HTTP
- **http-management.test.ts** - Management API endpoints
- **http-sessions.test.ts** - Session management and lifecycle

### Integration Tests

- **multi-transport.test.ts** - Mixed stdio + HTTP server scenarios
- **performance.test.ts** - Performance and load testing

## Test Utilities

### TestProcessManager

Manages child process lifecycle for stdio servers:

```typescript
const processManager = new TestProcessManager();
const processInfo = await processManager.startProcess('test-server', {
  command: 'node',
  args: ['path/to/server.js'],
  timeout: 10000,
});
```

### McpTestClient

Test client for MCP protocol communication:

```typescript
const client = new McpTestClient({
  transport: 'stdio',
  stdioConfig: {
    command: 'node',
    args: ['server.js'],
  },
});
await client.connect();
const response = await client.listTools();
```

### ConfigBuilder

Dynamic test configuration generation:

```typescript
const config = ConfigBuilder.create()
  .enableStdioTransport()
  .enableHttpTransport(3000)
  .addStdioServer('echo', 'node', ['echo-server.js'])
  .writeToFile();
```

### ProtocolValidator

Validates MCP message compliance:

```typescript
const validation = ProtocolValidator.validateRequest(request);
expect(validation.valid).toBe(true);
```

## Configuration

E2E tests use a separate vitest configuration (`vitest.e2e.config.ts`) with:

- Extended timeouts (60s test timeout, 30s setup/teardown)
- Sequential execution to avoid port conflicts
- Retry logic for flaky network issues
- Global setup/teardown for environment preparation

## Environment Variables

- `NODE_ENV=test` - Set automatically during E2E tests
- `LOG_LEVEL=warn` - Reduces log noise during testing
- `MCP_DISABLE_CONSOLE=true` - Disables console logging in MCP servers
- `CI=true` - Enables single fork mode for CI environments

## Best Practices

### Writing E2E Tests

1. **Use real processes** - E2E tests spawn actual MCP server processes
2. **Test real protocols** - Use actual JSON-RPC over stdin/stdout or HTTP
3. **Handle async properly** - Always await process startup/shutdown
4. **Clean up resources** - Use beforeEach/afterEach for proper cleanup
5. **Expect failures** - Test error conditions and edge cases

### Performance Considerations

- Tests run sequentially to avoid port conflicts
- Each test gets a fresh server instance
- Random ports are used for HTTP tests
- Cleanup timeouts prevent hanging tests

### CI/CD Integration

E2E tests are designed to run in CI environments:

- Cross-platform compatibility (Windows/Unix)
- Proper resource cleanup
- Reasonable timeout limits
- Retry logic for flaky conditions

## Troubleshooting

### Common Issues

1. **Port conflicts** - Tests use random ports, but conflicts can still occur
2. **Process cleanup** - Ensure proper cleanup in test teardown
3. **Timing issues** - Use appropriate waits for async operations
4. **Resource limits** - CI environments may have limited resources

### Debugging

- Use `test:e2e:watch` for interactive debugging
- Check process manager logs for startup issues
- Verify server fixture implementations
- Use protocol validator for message format issues

## Coverage and Quality

E2E tests complement unit tests by:

- Testing real process communication
- Validating protocol compliance
- Checking error handling under real conditions
- Performance testing with actual workloads
- Cross-platform compatibility verification

The E2E test suite provides confidence that the 1MCP agent works correctly in real-world scenarios with actual MCP servers and clients.

